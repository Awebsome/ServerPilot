<?php if(count($SystemUsers->get())>0):?>
    <div class="toolbar-widget list-header">
        <div class="toolbar-widget list-header">
            <div class="form-group span-full">
                <button
                    type="button"
                    data-control="popup"
                    data-handler="onCreateForm"
                    data-request-data="new_system_user: 1"
                    class="btn btn-primary oc-icon-user-plus"
                    style="margin-left: -20px;">
                    New User
                </button>
                <?=$this->makePartial('../syncs/sync_button')?>
            </div>
        </div>
        <?php foreach($SystemUsers->get() as $user => $value):?>
            <div class="callout fade in callout-warning no-icon no-subheader" style="display: inline-block; width: 49.5%;">
                <div class="header">
                    <h3><i class="oc-icon-user-secret"></i><?=$value->name?></h3>
                </div>
                <div class="content">
                    <div class="control-status-list">
                        <ul>
                            <li>
                                <span class="status-icon info"><i class="icon-hdd-o"></i></span>
                                <span class="status-text"><?=$value->server->name?></span>
                                <span class="status-label link"><a href="ssh://<?=$value->server->lastaddress?>">This user manages <?=count($value->apps)?> apps</a></span>
                            </li>
                            <li id="reset-<?=$value->id?>">
                                <span class="status-icon warning"><i class="icon-key"></i></span>
                                <span class="status-text"><b><span class="password">···Password···</span></b></span>
                                <span class="status-label link">
                                    <button 
                                    type="button"
                                    data-request="onResetPsw"
                                    data-request-confirm="Reset <?=$value->name?> password, are you sure?" 
                                    data-request-data="resource: 'Systemusers', resource_id: '<?=$value->id?>'" 
                                    data-request-success="jUpdatePassword(data);"
                                    data-request-loading="#<?=$value->id?>"  
                                    class="btn btn-warning btn-xs pull-right oc-icon-refresh">Reset</button>
                                    <div class="loading-indicator-container" style="display:none;" id="<?=$value->id?>">
                                        <div class="loading-indicator size-small">
                                            <span></span>
                                            <div>Resetting...</div>
                                        </div>
                                    </div>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        <?endforeach?>
    </div>
<?else:?>
<p class="flash-message static error">No users to display</p>
<?endif?>

<script>
    function jUpdatePassword(data){
        $('#reset-' + data.resource_id +' .password').text( data.newPassword );
        $('#reset-' + data.resource_id +' .password').addClass( 'text-success' );
        $('#reset-' + data.resource_id +' .btn').hide();
    }
</script>